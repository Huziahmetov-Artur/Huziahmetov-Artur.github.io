<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-signin-client_id"
        content="549966974005-1no2pbea347p5nd7b6dvtg9o2ut0gi50.apps.googleusercontent.com" />
    <title>Usercentrics client</title>
    <script src="https://apis.google.com/js/platform.js"></script>
</head>

<body>
    <div class="header">
        <div id="name"></div>
        <div id="email"></div>
        <img width="50" id="image" />
        <div class="g-signin2" data-onsuccess="googleSignIn"></div>
        <a href="#" onclick="googleSignOut();">Sign out</a>
        <div>
            WidgetId: <input type="text" id="widgetId">
        </div>
    </div>
    <main>
        <h1>PM</h1>
    </main>
    <script>
        let user = null;
        function updateUI() {
            document.getElementById("name").innerText = user?.name ?? "";
            document.getElementById("email").innerText = user?.email ?? "";
            document.getElementById("image").src = user?.image ?? "";
        }
        function googleSignOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
                console.log("User signed out.");
                user = null;
                document.getElementById('usercentricsPMScript').remove();
                document.getElementById('root').innerHTML = "";
                updateUI();
            });
        }

        let auth2;
        gapi.load("auth2", function () {
            auth2 = gapi.auth2.init({
                client_id:
                    "549966974005-1no2pbea347p5nd7b6dvtg9o2ut0gi50.apps.googleusercontent.com",
            });
        });

        function googleSignIn(googleUser) {
            var profile = googleUser.getBasicProfile();
            console.log("ID: " + profile.getId());
            console.log("Name: " + profile.getName());
            console.log("Image URL: " + profile.getImageUrl());
            console.log("Email: " + profile.getEmail());
            user = {
                name: profile.getName(),
                email: profile.getEmail(),
                image: profile.getImageUrl(),
            };
            updateUI();

            const js = document.createElement("script");
            const widgetId = document.getElementById('widgetId').value || 'Ew6Vnmd0x8';
            js.type = "text/javascript";
            js.setAttribute('settingsId', "mid4lHMgE9");
            js.setAttribute('widgetId', widgetId);
            js.id = 'usercentricsPMScript'

            js.src = "https://app.preference-management.usercentrics-staging.eu/form_generator.js";


            document.body.appendChild(js);
            js.onload = () => {
                console.log('loadUsercentricsPreferenceManagment', Window?.loadUsercentricsPreferenceManagment)
                Window?.loadUsercentricsPreferenceManagment(profile.getId());
            };

        }

        function onGoogleSignIn() {
            auth2.signIn().then((googleUser) => {
                googleSignIn(googleUser);
            });
        }

    </script>
    <div id="root"></div>
    <!-- <script src="form_generator.js" settingsId="mid4lHMgE9" widgetId="F9e8q"></script> -->
    <!-- <script src="form_generator.js" settingsId="mid4lHMgE9" widgetId="first_widget"></script> -->
    <!-- <script src="http://localhost:3000/link_generator.js" settingsId="DhxcTj2tYq"></script> -->

</body>

</html>